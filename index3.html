<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ì˜¤ëŠ˜ì˜ ìš´ì„¸</title>
  <style>
    :root { --gap:14px; }
    body { font-family: system-ui,-apple-system,Segoe UI,Arial,Apple SD Gothic Neo,Malgun Gothic,sans-serif; max-width: 720px; margin: 48px auto; padding: 0 16px; }
    h1 { margin: 0 0 18px; }
    .card { background:#f7f7f8; border:1px solid #e6e6e7; border-radius:12px; padding:18px; }
    .row { display:grid; grid-template-columns: 1fr 1fr; gap: var(--gap); }
    label { display:block; font-size:14px; color:#444; margin-bottom:6px; }
    input { width:100%; padding:10px 12px; border:1px solid #d0d0d4; border-radius:8px; }
    button { padding:11px 16px; border:0; border-radius:10px; cursor:pointer; }
    .primary { background:#4caf50; color:#fff; }
    .ghost { background:#fff; border:1px solid #ddd; }
    .actions { display:flex; gap:var(--gap); margin-top:var(--gap); }
    .result { margin-top:22px; }
    .fortune { background:#fff; border:1px solid #ececec; border-radius:12px; padding:16px; line-height:1.6; }
    .muted { color:#666; font-size:13px; }
    .err { color:#c62828; font-weight:600; }
    .ok { color:#2e7d32; font-weight:600; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; white-space: pre-wrap; }
  </style>
</head>
<body>
  <h1>ğŸ”® ì˜¤ëŠ˜ì˜ ìš´ì„¸</h1>

  <div class="card">
    <div class="row">
      <div>
        <label for="name">ì´ë¦„</label>
        <input id="name" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" value="í™ê¸¸ë™" />
      </div>
      <div>
        <label for="birth">ìƒë…„ì›”ì¼</label>
        <input id="birth" type="date" value="1995-06-01" />
      </div>
    </div>

    <div class="actions">
      <button id="go" class="primary">ìš´ì„¸ ë³´ê¸°</button>
      <button id="demo" class="ghost">ìƒ˜í”Œ ë°ì´í„°</button>
    </div>

    <p class="muted mono" id="status">ì¤€ë¹„ë¨</p>
    <div class="result" id="result"></div>
  </div>

  <script>
    // 1) í™˜ê²½ì— ë”°ë¼ API ì—”ë“œí¬ì¸íŠ¸ ìë™ ì„ íƒ
    const API = location.hostname.endsWith('github.io')
      ? 'https://joyyoon.pythonanywhere.com/api/fortune' // GitHub Pagesì—ì„œ ì‚¬ìš©
      : '/api/fortune';                                  // PythonAnywhere ê°™ì€ ë„ë©”ì¸ì—ì„œ ì‚¬ìš©

    const $ = (id) => document.getElementById(id);
    const nameEl = $('name');
    const birthEl = $('birth');
    const statusEl = $('status');
    const resultEl = $('result');
    const goBtn = $('go');
    const demoBtn = $('demo');

    function setStatus(msg, ok=true) {
      statusEl.textContent = msg;
      statusEl.className = 'muted mono ' + (ok ? 'ok' : 'err');
    }

    function renderResult(data) {
      resultEl.innerHTML = `
        <div class="fortune">
          <div class="mono" style="margin-bottom:10px;">${data.date}</div>
          <h2 style="margin:0 0 6px;">${data.name}ë‹˜ì˜ ì˜¤ëŠ˜ ìš´ì„¸</h2>
          ${data.love ? `<p>ğŸ’• ì—°ì• ìš´: ${data.love}</p>` : ``}
          ${data.career ? `<p>ğŸ’¼ ì§ì¥ìš´: ${data.career}</p>` : ``}
          ${data.health ? `<p>ğŸƒ ê±´ê°•ìš´: ${data.health}</p>` : ``}
          <p>ğŸ² í–‰ìš´ì˜ ìˆ«ì: <strong>${data.lucky_number}</strong></p>
        </div>
      `;
    }

    async function getFortune() {
      const name = (nameEl.value || 'í™ê¸¸ë™').trim();
      const birthdate = birthEl.value || '1990-01-01';

      setStatus('ìš”ì²­ ì¤‘â€¦ ì ì‹œë§Œìš”.', true);
      goBtn.disabled = true;

      try {
        const res = await fetch(API, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, birthdate })
        });

        if (!res.ok) throw new Error('HTTP ' + res.status);
        const data = await res.json();
        renderResult(data);
        setStatus('ì™„ë£Œ', true);
      } catch (err) {
        setStatus('ìš”ì²­ ì‹¤íŒ¨: ' + err.message + ' (ì—”ë“œí¬ì¸íŠ¸: ' + API + ')', false);
        resultEl.textContent = '';
      } finally {
        goBtn.disabled = false;
      }
    }

    // ìƒ˜í”Œ ë²„íŠ¼: ì…ë ¥ê°’ ì±„ìš°ê³  ë°”ë¡œ ì‹¤í–‰
    demoBtn.onclick = () => {
      nameEl.value = 'ê¹€í…ŒìŠ¤íŠ¸';
      birthEl.value = '1999-12-31';
      getFortune();
    };
    goBtn.onclick = getFortune;
  </script>
</body>
</html>
